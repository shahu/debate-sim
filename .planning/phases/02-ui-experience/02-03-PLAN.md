---
phase: 02-ui-experience
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/TranscriptPanel.tsx
  - src/components/MotionInput.tsx
  - src/components/StartDebateButton.tsx
  - src/components/POIControls.tsx
  - src/components/DebateDashboard.tsx
autonomous: false

must_haves:
  truths:
    - "User can enter a debate motion in 'This House believes that...' format"
    - "User can click Start to begin a debate"
    - "User sees live transcript of debate as it progresses"
    - "User can offer/accept/reject POIs during non-protected time"
    - "Transcript auto-scrolls to show latest content"
  artifacts:
    - path: "src/components/TranscriptPanel.tsx"
      provides: "Scrollable transcript display with live updates"
      exports: ["TranscriptPanel"]
    - path: "src/components/MotionInput.tsx"
      provides: "Motion input form with validation"
      exports: ["MotionInput"]
    - path: "src/components/StartDebateButton.tsx"
      provides: "Start debate button with loading state"
      exports: ["StartDebateButton"]
    - path: "src/components/POIControls.tsx"
      provides: "POI offer/accept/reject buttons"
      exports: ["POIControls"]
  key_links:
    - from: "src/components/TranscriptPanel.tsx"
      to: "src/store/debateStore.ts"
      via: "transcript subscription"
      pattern: "transcript"
    - from: "src/components/MotionInput.tsx"
      to: "src/lib/constants.ts"
      via: "DEBATE_MOTION_REGEX validation"
      pattern: "DEBATE_MOTION_REGEX"
    - from: "src/components/StartDebateButton.tsx"
      to: "src/store/debateStore.ts"
      via: "startDebate action"
      pattern: "startDebate"
    - from: "src/components/POIControls.tsx"
      to: "src/lib/poiMechanism.ts"
      via: "POI handling functions"
      pattern: "requestPOI|acceptPOI|rejectPOI"
---

<objective>
Create interactive elements including transcript panel, motion input, and POI controls that engage users throughout the debate.

Purpose: Delivers rich interactive elements (UI-05) that let users start debates, see live content, and interact with POI mechanism.
Output: Complete interactive debate interface with motion input, transcript display, and POI controls.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-ui-experience/02-01-SUMMARY.md

# Existing source files
@src/store/debateStore.ts
@src/lib/constants.ts
@src/lib/poiMechanism.ts
@src/components/SpeakerCard.tsx
@src/components/DebateDashboard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Transcript Panel with Auto-Scroll</name>
  <files>
    - src/components/TranscriptPanel.tsx
    - src/components/DebateDashboard.tsx
  </files>
  <action>
    Create the live transcript display component:
    
    1. **src/components/TranscriptPanel.tsx**:
       - Import useDebateStore and get transcript array
       - Import SpeakerCard component for rendering entries
       
       **Layout**:
       - Container with fixed height (h-96 or h-[400px])
       - Overflow-y-auto for scrolling
       - Subtle border and rounded corners
       - Light background (bg-white or bg-gray-50)
       
       **Content**:
       - Map transcript entries to SpeakerCard components
       - Pass entry.speaker, entry.content, entry.timestamp, entry.type
       - Empty state: "Debate transcript will appear here..." in muted text
       
       **Auto-scroll**:
       - Use useRef for scroll container
       - Use useEffect to scroll to bottom when transcript changes
       - scrollIntoView({ behavior: 'smooth' }) for smooth scroll
       - Add a "scroll to bottom" button that appears when user scrolls up
       
       **Styling**:
       - Padding inside container
       - Gap between transcript entries
       - Fade gradient at top when scrolled down (optional)
    
    2. Update **src/components/DebateDashboard.tsx**:
       - Import TranscriptPanel
       - Add TranscriptPanel below controls
       - Use flex layout: left side for controls/status, right side for transcript
       - Or vertical layout on mobile: transcript at bottom
       - Give transcript proper width (flex-1 or w-2/3)
  </action>
  <verify>
    Run `npm run dev`:
    - Transcript panel renders with empty state
    - When entries exist in store, SpeakerCards display
    - Scrolling works properly
    - Auto-scroll triggers on new entries (test by adding entry to store via devtools)
    - TypeScript: `npx tsc --noEmit`
  </verify>
  <done>
    Transcript panel displays debate content in real-time with auto-scroll.
    SpeakerCards show role-colored entries.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Motion Input and Start Debate Components</name>
  <files>
    - src/components/MotionInput.tsx
    - src/components/StartDebateButton.tsx
    - src/components/DebateDashboard.tsx
  </files>
  <action>
    Create the debate initialization components:
    
    1. **src/components/MotionInput.tsx**:
       - Props: { value: string, onChange: (value: string) => void, disabled?: boolean }
       - Import DEBATE_MOTION_REGEX from constants for validation
       
       **Layout**:
       - Label: "Debate Motion"
       - Textarea input (3-4 rows) for motion text
       - Placeholder: "This House believes that..."
       - Character count display
       
       **Validation**:
       - Check against DEBATE_MOTION_REGEX
       - Show error if doesn't match: "Motion must start with 'This House believes that...'"
       - Border color: normal gray, error red, valid green
       - Validation message below input
       
       **Styling**:
       - Full width textarea
       - Proper padding and rounded corners
       - Focus ring on focus
       - Disabled state: bg-gray-100, cursor-not-allowed
    
    2. **src/components/StartDebateButton.tsx**:
       - Props: { motion: string, disabled?: boolean }
       - Import useDebateStore: startDebate, status
       - Import DEBATE_MOTION_REGEX for validation
       
       **Button**:
       - Text: "Start Debate" with play icon
       - onClick: validate motion, then call startDebate(motion)
       - Disabled when: status !== 'idle' OR motion invalid
       - Loading state when status === 'preparing'
       
       **Styling**:
       - Large button: px-8 py-3, text-lg
       - Color: bg-blue-600 hover:bg-blue-700
       - Disabled: opacity-50, cursor-not-allowed
       - Loading: spinner icon, "Preparing..." text
    
    3. Update **src/components/DebateDashboard.tsx**:
       - Add motion state with useState
       - Show MotionInput and StartDebateButton only when status === 'idle'
       - Hide them once debate starts (status !== 'idle')
       - Layout: centered form with motion input above start button
  </action>
  <verify>
    Run `npm run dev`:
    - Motion input shows with placeholder
    - Validation works (error for invalid format)
    - Start button disabled until valid motion entered
    - Clicking Start changes status to 'active'
    - Motion input hides after debate starts
    - TypeScript: `npx tsc --noEmit`
  </verify>
  <done>
    Users can input motion and start debate (UI-05 partial).
    Validation ensures proper "This House believes that..." format.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create POI Controls Component</name>
  <files>
    - src/components/POIControls.tsx
    - src/components/DebateDashboard.tsx
  </files>
  <action>
    Create POI interaction controls:
    
    1. **src/components/POIControls.tsx**:
       - Import useDebateStore: currentSpeaker, status, timeRemaining
       - Import from poiMechanism: requestPOI, acceptPOI, rejectPOI, canOfferPOI
       - Import DEFAULT_TIMERS, PROTECTED_TIME_START, PROTECTED_TIME_END from constants
       
       **POI State Calculation**:
       - Calculate if currently in protected time based on:
         - timeRemaining > (totalTime - PROTECTED_TIME_START) = first minute protected
         - timeRemaining < PROTECTED_TIME_END = last minute protected
       - Show different UI based on protected time status
       
       **During Protected Time**:
       - Show message: "POI not allowed (protected time)"
       - Muted styling, icon showing lock or shield
       
       **During POI-Allowed Time (as opposing team)**:
       - "Offer POI" button
       - onClick: call requestPOI with current context
       - Styling: bg-purple-600, hover state
       
       **When POI is Offered (as current speaker)**:
       - Show POI notification: "POI Offered!"
       - Two buttons: "Accept" (green) and "Reject" (red)
       - Accept calls acceptPOI(), Reject calls rejectPOI()
       - Add subtle animation to draw attention
       
       **POI Timer**:
       - POI has max 15 second window to respond
       - Show countdown for POI response time
       - Auto-reject if timer expires
       
       **Styling**:
       - Compact control bar below timer
       - Clear visual hierarchy
       - Accessible button labels
    
    2. Update **src/components/DebateDashboard.tsx**:
       - Import POIControls
       - Add POIControls below or beside DebateControls
       - Only show when status === 'active'
  </action>
  <verify>
    Run `npm run dev`:
    - POI controls show during active debate
    - Protected time message shows during first/last minute
    - POI button appears during allowed time
    - Accept/Reject buttons appear when POI offered
    - TypeScript: `npx tsc --noEmit`
  </verify>
  <done>
    POI controls enable interactive point of information during debate (UI-05 complete).
    Users can offer, accept, or reject POIs.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 2 UI Experience implementation:
    - Dashboard with speaker indicator and timer (UI-01)
    - Role-colored speaker cards (UI-02)
    - Smooth transitions and animations (UI-03)
    - Pause/Resume/Restart controls (UI-04)
    - Motion input, Start debate, POI controls (UI-05)
    - Debate flow progress indicator (UI-06)
  </what-built>
  <how-to-verify>
    1. Run `npm run dev` and open http://localhost:5173
    
    2. **Test Idle State**:
       - Verify motion input visible with placeholder
       - Verify flow indicator shows all 4 speakers in gray
       - Verify "Waiting to start..." message
    
    3. **Start a Debate**:
       - Enter: "This House believes that AI will benefit humanity"
       - Click Start Debate
       - Verify speaker indicator shows PM with blue color
       - Verify timer shows 07:00 and counts down
       - Verify flow indicator highlights PM
    
    4. **Test Controls**:
       - Click Pause - verify timer stops, Resume button appears
       - Click Resume - verify timer continues
       - Verify POI controls show appropriate state
    
    5. **Visual Quality**:
       - Verify smooth animations on speaker change
       - Verify each role has distinct color (PM blue, LO red, MO orange, PW green)
       - Verify timer pulses when time is low
    
    6. **Responsive**:
       - Resize browser to mobile width
       - Verify layout adapts appropriately
  </how-to-verify>
  <resume-signal>Type "approved" to confirm Phase 2 UI is complete, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:
1. Motion input validates correctly
2. Start debate initializes the debate
3. Transcript shows entries with role colors
4. POI controls work during non-protected time
5. All interactive elements are engaging
6. TypeScript compilation passes: `npx tsc --noEmit`
7. Human verification confirms visual quality
</verification>

<success_criteria>
- UI-05: Rich interactive elements engage user throughout debate
  - Motion input with validation
  - Start debate button
  - POI controls with offer/accept/reject
  - Live transcript with auto-scroll
- All Phase 2 requirements (UI-01 through UI-06) complete
- Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/02-ui-experience/02-03-SUMMARY.md`
</output>
