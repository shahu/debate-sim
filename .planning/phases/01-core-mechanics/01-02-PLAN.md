---
phase: 01-core-mechanics
plan: 02
type: execute
wave: 2
depends_on: [01-01]
files_modified: 
  - src/hooks/useDebateTimer.ts
  - src/lib/debateRules.ts
  - src/lib/aiAgents.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "System enforces correct timing for each debate role (PM: 7min, LO: 8min, MO: 4min, PW: 4min)"
    - "AI agents follow role-specific behavioral patterns and argumentation styles"
    - "AI agents generate content that adheres to CPDL rules and format requirements"
    - "LO challenges PM definition and MO/PW don't introduce new arguments"
  artifacts:
    - path: "src/hooks/useDebateTimer.ts"
      provides: "Timer functionality for debate roles"
      contains: "useDebateTimer hook with start, pause, reset functions"
    - path: "src/lib/debateRules.ts"
      provides: "Rule enforcement logic for CPDL format"
      contains: "validateMotionFormat, enforceRoleRules, checkPOIPeriod functions"
    - path: "src/lib/aiAgents.ts"
      provides: "AI agent configuration with role-specific instructions"
      contains: "createSpeakerAgent function with role-specific system prompts"
  key_links:
    - from: "src/hooks/useDebateTimer.ts"
      to: "src/lib/constants.ts"
      via: "import timer constants"
      pattern: "import.*DEFAULT_TIMERS"
    - from: "src/lib/aiAgents.ts"
      to: "src/lib/debateRules.ts"
      via: "use rule validation"
      pattern: "import.*enforceRoleRules"

---

<objective>
Implement the core mechanics including timing controls, rule enforcement, and AI agent configuration with role-specific behaviors. This plan creates the timer hook, rule validation functions, and AI agent configuration that enforces CPDL format requirements.

Purpose: Enable timing enforcement and role-specific rule compliance for the debate system
Output: Timer hook, rule enforcement functions, and AI agent configuration
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-mechanics/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Debate Timer Hook</name>
  <files>src/hooks/useDebateTimer.ts</files>
  <action>Create a React hook that manages debate timing:
- Implement useState and useEffect for timer management
- Include functions for startTimer, pauseTimer, resetTimer, and setTimeRemaining
- Track isRunning, timeRemaining, and startTime states
- Implement useEffect for interval management with proper cleanup
- Validate against DEFAULT_TIMERS from constants
- Include callback functions for onTick, onTimeout
- Follow React hook best practices with proper dependencies</action>
  <verify>Hook compiles without errors and follows React best practices</verify>
  <done>Functional timer hook that properly manages debate timing</done>
</task>

<task type="auto">
  <name>Task 2: Create Rule Enforcement Functions</name>
  <files>src/lib/debateRules.ts</files>
  <action>Create functions to enforce CPDL rules:
- validateMotionFormat function that checks for "This House believes that..." format using DEBATE_MOTION_REGEX
- enforceRoleRules function that validates content against role-specific requirements:
  * For LO: ensures challenge to PM definition is present
  * For MO/PW: ensures no new arguments are introduced
  * For PM: ensures case is properly outlined
- checkPOIPeriod function that determines if current time allows POIs (outside protected periods)
- isProtectedTime function that identifies protected time windows
- All functions should accept appropriate parameters and return boolean/validation results</action>
  <verify>Functions compile and have proper TypeScript signatures</verify>
  <done>Rule enforcement functions that properly validate debate content</done>
</task>

</tasks>

<verification>
- Timer hook properly manages time for each debate role
- Rule enforcement functions correctly validate debate content according to CPDL rules
- All functions handle edge cases and return appropriate results
- Timer properly integrates with constants from task 1
</verification>

<success_criteria>
- Timer hook functions correctly with start, pause, reset operations
- Rule enforcement functions properly validate debate content
- Both modules export their functions correctly
- TypeScript compilation succeeds with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-mechanics/01-02-SUMMARY.md`
</output>