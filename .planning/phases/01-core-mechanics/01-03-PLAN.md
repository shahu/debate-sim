---
phase: 01-core-mechanics
plan: 03
type: execute
wave: 2
depends_on: [01-02]
files_modified: 
  - src/lib/aiAgents.ts
  - src/lib/debateEngine.ts
  - src/store/debateStore.ts
  - src/lib/poiMechanism.ts
autonomous: true
user_setup:
  - service: ai-provider
    why: "AI agent functionality"
    env_vars:
      - name: OPENAI_API_KEY
        source: "OpenAI Dashboard -> API Keys"
      - name: DEEPSEEKV3_API_KEY
        source: "DeepSeek Dashboard -> API Keys"

must_haves:
  truths:
    - "Each role (PM, LO, MO, PW) has an AI agent that generates appropriate responses"
    - "AI agents maintain context of previous debate content and incorporate it"
    - "System implements POI (Points of Information) mechanism during non-protected time periods"
    - "System provides real-time turn synchronization between speakers"
  artifacts:
    - path: "src/lib/aiAgents.ts"
      provides: "AI agent implementation with role-specific instructions"
      contains: "createSpeakerAgent function with Vercel AI SDK integration"
    - path: "src/lib/debateEngine.ts"
      provides: "Core debate orchestration logic"
      contains: "startDebate, nextSpeaker, handlePOI functions"
    - path: "src/store/debateStore.ts"
      provides: "Global debate state management"
      contains: "Zustand store with debate state and actions"
    - path: "src/lib/poiMechanism.ts"
      provides: "POI handling and insertion logic"
      contains: "requestPOI, acceptPOI, rejectPOI functions"
  key_links:
    - from: "src/lib/debateEngine.ts"
      to: "src/lib/aiAgents.ts"
      via: "use AI agents for content generation"
      pattern: "import.*createSpeakerAgent"
    - from: "src/store/debateStore.ts"
      to: "src/types/debate.ts"
      via: "use debate state types"
      pattern: "import.*DebateState"
    - from: "src/lib/poiMechanism.ts"
      to: "src/lib/debateRules.ts"
      via: "validate POI timing"
      pattern: "import.*checkPOIPeriod"

---

<objective>
Complete the core mechanics by implementing AI agents with role-specific behaviors, the debate engine for orchestration, state management, and POI mechanism. This plan creates the AI integration, debate flow control, and state management needed to run a complete debate.

Purpose: Enable full debate execution with AI agents, turn management, and POI handling
Output: AI agents, debate engine, state management, and POI mechanism
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-mechanics/01-01-SUMMARY.md
@.planning/phases/01-core-mechanics/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement AI Agents with Vercel AI SDK</name>
  <files>src/lib/aiAgents.ts</files>
  <action>Implement AI agents using Vercel AI SDK:
- Import from "@ai-sdk/openai" or appropriate provider
- Create createSpeakerAgent function that takes role and context parameters
- Implement role-specific system prompts following CPDL rules:
  * PM: Define motion clearly and present structured arguments
  * LO: Challenge PM definition and present opposition case
  * MO: Extend government arguments and rebut opposition
  * PW: Extend opposition arguments and rebut government
- Include conversation history in AI calls to maintain context
- Implement proper error handling for API failures
- Use TypeScript interfaces for consistent return types</action>
  <verify>AI agents can be instantiated and called with proper parameters</verify>
  <done>Functional AI agents that generate role-appropriate content with context awareness</done>
</task>

<task type="auto">
  <name>Task 2: Create Debate Engine and State Management</name>
  <files>src/lib/debateEngine.ts, src/store/debateStore.ts</files>
  <action>Create debate orchestration system:
- Create debateStore using Zustand with state management for:
  * Current speaker, time remaining, debate transcript, motion
  * Actions for startDebate, nextSpeaker, addTranscriptEntry
  * Proper TypeScript typing with interfaces from debate.ts
- Create debateEngine with functions:
  * startDebate: Initialize debate with motion and first speaker
  * nextSpeaker: Advance to next speaker in sequence
  * handleTurn: Manage turn timing and content generation
  * endDebate: Finalize debate and prepare results
- Integrate with timer hook for time management
- Integrate with AI agents for content generation</action>
  <verify>Debate engine can start, progress, and end debates properly</verify>
  <done>Functional debate engine with proper state management and turn progression</done>
</task>

<task type="auto">
  <name>Task 3: Implement POI Mechanism</name>
  <files>src/lib/poiMechanism.ts</files>
  <action>Create Points of Information handling system:
- requestPOI function that handles POI requests from non-current speakers
- acceptPOI function that temporarily interrupts current speaker
- rejectPOI function that maintains current speaker's turn
- validatePOIRequest function that checks timing rules (non-protected periods)
- update transcript to include POI markers and content
- integrate with debate rules to ensure POIs happen during allowed periods
- ensure POIs are properly tracked in debate state</action>
  <verify>POI functions work properly and respect timing constraints</verify>
  <done>Functional POI mechanism that follows CPDL timing rules</done>
</task>

</tasks>

<verification>
- AI agents generate role-appropriate content following CPDL rules
- Debate engine properly manages turn progression and timing
- POI mechanism respects protected time periods and functions correctly
- State management properly tracks debate progress and transcript
- All components work together to run a complete debate
</verification>

<success_criteria>
- AI agents generate content that follows role-specific rules
- Debate engine properly orchestrates the debate flow
- POI mechanism works during appropriate time periods
- State is properly managed throughout the debate
- All components integrate successfully to create a functional debate system
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-mechanics/01-03-SUMMARY.md`
</output>