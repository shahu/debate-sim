---
phase: 04-audio-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/voiceRegistry.ts
  - src/store/audioStore.ts
autonomous: true

must_haves:
  truths:
    - "Each debate role (PM, LO, MO, PW) maps to a distinct voice ID"
    - "Audio state (volume, playback rate, mute) persists across component navigation via Zustand runtime store"
    - "Voice registry supports both pyttsx3 and ElevenLabs providers"
  artifacts:
    - path: "src/lib/voiceRegistry.ts"
      provides: "Role to voice ID mapping for TTS"
      exports: ["VOICE_REGISTRY", "getVoiceIdForRole"]
    - path: "src/store/audioStore.ts"
      provides: "Global audio state management"
      exports: ["useAudioStore", "AudioState"]
  key_links:
    - from: "src/lib/voiceRegistry.ts"
      to: "src/types/debate.ts"
      via: "SpeakerRole enum import"
      pattern: "import.*SpeakerRole"
    - from: "src/store/audioStore.ts"
      to: "src/store/debateStore.ts"
      via: "Zustand store pattern consistency"
      pattern: "create<.*>"
---

<objective>
Create audio infrastructure foundation with voice registry mapping debate roles to distinct TTS voices, and global audio store for persistent audio controls state.

Purpose: Establish the data structures and state management needed for role-based audio differentiation and user audio controls.

Output: Voice registry configuration, Zustand audio store with volume/playback/mute state.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-audio-enhancement/04-RESEARCH.md

# Existing codebase
@src/types/debate.ts
@backend/src/tts.py
@src/store/debateStore.ts

# Prior phase context
@.planning/phases/03-streaming/03-03-SUMMARY.md
@.planning/quick/001-create-python-backend-llm-tts-api/001-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create voice registry for role-based voice mapping</name>
  <files>src/lib/voiceRegistry.ts</files>
  <action>
Create `src/lib/voiceRegistry.ts` with the following:

1. Import SpeakerRole enum from types/debate.ts
2. Define VoiceConfig interface with id, name, provider fields
3. Create VOICE_REGISTRY as Record<SpeakerRole, VoiceConfig> mapping:
   - PM → pyttsx3 voice index "0" (first available voice)
   - LO → pyttsx3 voice index "1" (second available voice)
   - MO → pyttsx3 voice index "2" (third available voice)
   - PW → pyttsx3 voice index "3" (fourth available voice)
4. Create ELEVENLABS_VOICE_REGISTRY mapping SpeakerRole to actual voice IDs:
   - PM → "pNInz6obpgDQGcFmaJgB" (Adam)
   - LO → "EXAVITQu4vr4xnSDxMaL" (Bella)
   - MO → "IKne3meq5aSn9XLyUdCD" (Charlie)
   - PW → "MF3mGyEYCl7XYWbV9V6O" (Elli)
5. Export getVoiceIdForRole(role: SpeakerRole, provider: 'pyttsx3' | 'elevenlabs'): string function that returns appropriate voice ID based on provider

DO NOT:
- Add voice selection UI (that's in a later plan)
- Query backend for voice list (backend already provides static voice list)
- Handle voice availability validation (fallback handled in backend)

Reference backend voice IDs from backend/src/tts.py get_available_voices() function.
  </action>
  <verify>
```bash
npm run build
```
Build succeeds without TypeScript errors.
  </verify>
  <done>
Voice registry created with role-to-voice mappings for both pyttsx3 (indices 0-3) and ElevenLabs (UUIDs), getVoiceIdForRole function exported.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create audio store for global state management</name>
  <files>src/store/audioStore.ts</files>
  <action>
Create `src/store/audioStore.ts` with the following:

1. Import create from zustand
2. Define AudioState interface with:
   - volume: number (0.0 to 2.0, default 1.0)
   - playbackRate: number (0.5 to 2.5, default 1.0)
   - isMuted: boolean (default false)
   - isEnabled: boolean (default true, global TTS on/off)
3. Define AudioState actions:
   - setVolume: (vol: number) => void
   - setPlaybackRate: (rate: number) => void
   - toggleMute: () => void
   - toggleEnabled: () => void
   - resetAudio: () => void
4. Export useAudioStore as default using zustand's create function

Follow same pattern as debateStore.ts for consistency.

DO NOT:
- Add AudioContext initialization (that's in useAudioControls hook)
- Add isPlaying state (that's per-component via useStreamingTTS)
- Persist to localStorage (keep it runtime-only for now)
  </action>
  <verify>
```bash
npm run build
```
Build succeeds without TypeScript errors, audioStore compiles.
  </verify>
  <done>
Audio store created with volume, playbackRate, isMuted, isEnabled state and actions (setVolume, setPlaybackRate, toggleMute, toggleEnabled, resetAudio).
  </done>
</task>

</tasks>

<verification>
- Voice registry compiles with TypeScript
- Audio store compiles with TypeScript
- Voice IDs match backend expectations (pyttsx3 indices as strings, ElevenLabs as UUIDs)
- Audio store follows Zustand pattern consistent with debateStore.ts
</verification>

<success_criteria>
Build succeeds, voice registry provides role-to-voice mappings for both TTS providers, audio store exports useAudioStore with all state and actions.
</success_criteria>

<output>
After completion, create `.planning/phases/04-audio-enhancement/04-01-SUMMARY.md`
</output>
